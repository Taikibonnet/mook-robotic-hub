<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Authentication - MOOK Robotics Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/theme.css">
    <style>
        .github-auth-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .auth-step {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #eee;
        }
        
        .auth-step:last-child {
            border-bottom: none;
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .auth-form {
            margin-top: 1.5rem;
        }
        
        .auth-status {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 4px;
        }
        
        .auth-status.success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .auth-status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .auth-status.info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .code-block {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .token-input {
            width: 100%;
            font-family: monospace;
            padding: 0.5rem;
        }
        
        .screenshot {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .auth-warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <header>
        <nav class="main-nav">
            <div class="logo">
                <svg width="50" height="50" viewBox="0 0 50 50" class="logo-svg">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="var(--primary-color)" stroke-width="2" />
                    <circle cx="25" cy="25" r="5" fill="var(--primary-color)" />
                    <path d="M25 10 L25 5" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M25 45 L25 40" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M10 25 L5 25" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M45 25 L40 25" stroke="var(--primary-color)" stroke-width="2" />
                </svg>
                <span>MOOK Robotics Hub</span>
            </div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="robots/index.html">Encyclopedia</a>
                <a href="news.html">News</a>
                <a href="index.html#about">About</a>
                <a href="admin/dashboard.html" class="admin-link" style="display: none;"><i class="fas fa-cog"></i> Admin</a>
            </div>
            <div class="nav-auth">
                <button id="login-btn" class="btn btn-primary">Login</button>
                <button id="signup-btn" class="btn btn-outline">Sign Up</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="github-auth-container">
            <h1>GitHub Authentication</h1>
            <p>To enable permanent storage of your robot data and images, you need to authenticate with GitHub. This guide will walk you through the process.</p>
            
            <div class="auth-warning">
                <strong>Important:</strong> Your GitHub token is stored only in your browser's localStorage. It is not sent to any server other than GitHub's API. However, you should treat this token as a password and not share it with others.
            </div>
            
            <div class="auth-step">
                <h2><span class="step-number">1</span> Create a GitHub Personal Access Token</h2>
                <p>To authenticate with GitHub, you need to create a Personal Access Token. Follow these steps:</p>
                <ol>
                    <li>Go to <a href="https://github.com/settings/tokens" target="_blank">GitHub Personal Access Tokens</a> (you'll need to be logged in to GitHub)</li>
                    <li>Click on "Generate new token" and then "Generate new token (classic)"</li>
                    <li>Give your token a descriptive name like "MOOK Robotics Hub"</li>
                    <li>Set the expiration to your preferred duration (e.g., 90 days)</li>
                    <li>Select the following scopes:
                        <ul>
                            <li><strong>repo</strong> (Full control of private repositories)</li>
                        </ul>
                    </li>
                    <li>Click "Generate token"</li>
                    <li>Copy the generated token (you won't be able to see it again!)</li>
                </ol>
            </div>
            
            <div class="auth-step">
                <h2><span class="step-number">2</span> Enter Your GitHub Token</h2>
                <p>Enter the Personal Access Token you just created:</p>
                <div class="auth-form">
                    <input type="password" id="github-token" class="token-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                    <button id="save-token" class="btn btn-primary" style="margin-top: 1rem;">Save Token</button>
                </div>
                <div id="auth-status" class="auth-status" style="display: none;"></div>
            </div>
            
            <div class="auth-step">
                <h2><span class="step-number">3</span> Test Your Authentication</h2>
                <p>Test your GitHub authentication to make sure it's working correctly:</p>
                <button id="test-auth" class="btn btn-outline">Test Authentication</button>
                <div id="test-status" class="auth-status" style="display: none;"></div>
            </div>
            
            <div class="auth-step">
                <h2><span class="step-number">4</span> Next Steps</h2>
                <p>Once you've authenticated with GitHub, you can use the MOOK Robotics Hub website as usual. Your data will now be stored in your GitHub repository.</p>
                <ul>
                    <li>All robot data will be saved to a <code>data/robots.json</code> file in your repository</li>
                    <li>Images will be saved to the <code>images/robots/</code> folder</li>
                    <li>You can view your repository at <code>https://github.com/TaikiBonnet/mook-robotic-hub</code></li>
                </ul>
                <div class="button-group" style="margin-top: 1.5rem;">
                    <a href="index.html" class="btn btn-primary">Go to Home</a>
                    <a href="robots/index.html" class="btn btn-outline">Go to Encyclopedia</a>
                    <a href="admin/dashboard.html" class="btn btn-outline">Go to Admin Dashboard</a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>MOOK Robotics Hub</h3>
                <p>Your interactive guide to the world of robotics</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="robots/index.html">Encyclopedia</a></li>
                    <li><a href="news.html">News</a></li>
                    <li><a href="index.html#about">About</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                <ul>
                    <li><a href="mailto:info@mookrobotics.com">info@mookrobotics.com</a></li>
                    <li><a href="contact.html">Contact Form</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Account</h3>
                <ul>
                    <li><a href="#login" id="footer-login">Login</a></li>
                    <li><a href="#signup" id="footer-signup">Sign Up</a></li>
                    <li><a href="my-account.html">My Account</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 MOOK Robotics Hub. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script type="module">
        import { initGitHubStorage, loadStoredToken, isAuthenticated } from './js/github-storage-service.js';

        document.addEventListener('DOMContentLoaded', function() {
            const githubTokenInput = document.getElementById('github-token');
            const saveTokenBtn = document.getElementById('save-token');
            const authStatusEl = document.getElementById('auth-status');
            const testAuthBtn = document.getElementById('test-auth');
            const testStatusEl = document.getElementById('test-status');
            
            // Check if token is already stored
            if (loadStoredToken() && isAuthenticated()) {
                authStatusEl.innerHTML = '<i class="fas fa-check-circle"></i> Token is already saved and valid.';
                authStatusEl.className = 'auth-status success';
                authStatusEl.style.display = 'block';
            }
            
            // Save token button click handler
            saveTokenBtn.addEventListener('click', function() {
                const token = githubTokenInput.value.trim();
                
                if (!token) {
                    showAuthStatus('error', 'Please enter a valid GitHub token.');
                    return;
                }
                
                try {
                    // Initialize GitHub storage with the token
                    initGitHubStorage(token);
                    
                    // Show success message
                    showAuthStatus('success', 'Token saved successfully!');
                    
                    // Clear the input field for security
                    githubTokenInput.value = '';
                } catch (error) {
                    console.error('Error saving token:', error);
                    showAuthStatus('error', 'Error saving token. Please try again.');
                }
            });
            
            // Test authentication button click handler
            testAuthBtn.addEventListener('click', async function() {
                testStatusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing authentication...';
                testStatusEl.className = 'auth-status info';
                testStatusEl.style.display = 'block';
                
                if (!isAuthenticated()) {
                    testStatusEl.innerHTML = '<i class="fas fa-times-circle"></i> Not authenticated. Please save your GitHub token first.';
                    testStatusEl.className = 'auth-status error';
                    return;
                }
                
                try {
                    // Test authentication by making a simple API request
                    const response = await fetch(`https://api.github.com/repos/TaikiBonnet/mook-robotic-hub`, {
                        headers: {
                            'Authorization': `token ${localStorage.getItem('github_token')}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        testStatusEl.innerHTML = `<i class="fas fa-check-circle"></i> Authentication successful! Connected to repository: ${data.full_name}`;
                        testStatusEl.className = 'auth-status success';
                    } else {
                        const errorData = await response.json();
                        testStatusEl.innerHTML = `<i class="fas fa-times-circle"></i> Authentication failed: ${errorData.message || 'Unknown error'}`;
                        testStatusEl.className = 'auth-status error';
                    }
                } catch (error) {
                    console.error('Error testing authentication:', error);
                    testStatusEl.innerHTML = `<i class="fas fa-times-circle"></i> Error testing authentication: ${error.message || 'Unknown error'}`;
                    testStatusEl.className = 'auth-status error';
                }
            });
            
            // Helper function to show auth status
            function showAuthStatus(type, message) {
                authStatusEl.innerHTML = type === 'success' ? 
                    `<i class="fas fa-check-circle"></i> ${message}` : 
                    `<i class="fas fa-times-circle"></i> ${message}`;
                authStatusEl.className = `auth-status ${type}`;
                authStatusEl.style.display = 'block';
            }
        });
    </script>
</body>
</html>
