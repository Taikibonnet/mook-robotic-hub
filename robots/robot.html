<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Details - MOOK Robotics Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="../css/encyclopedia.css">
    <link rel="stylesheet" href="../css/robot-detail.css">
    <style>
        .admin-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            cursor: pointer;
            border: none;
        }
        
        .admin-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
        }
        
        .admin-button i {
            font-size: 24px;
        }

        /* Content formatting improvements */
        .robot-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .robot-content iframe {
            width: 100%;
            aspect-ratio: 16/9;
            margin: 1.5rem auto;
            border-radius: var(--border-radius);
            border: none;
            box-shadow: var(--shadow);
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            margin: 1.5rem 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .video-container iframe,
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .preview-notice {
            background-color: var(--accent-color);
            color: var(--text-color);
            padding: 10px 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .preview-notice i {
            margin-right: 10px;
            font-size: 1.2em;
        }

        /* Image loading animation */
        .image-loading {
            position: relative;
            background-color: var(--background-light);
            overflow: hidden;
        }

        .image-loading::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: loading-animation 1.5s infinite;
        }

        @keyframes loading-animation {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* Lightbox for gallery images */
        #lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        #lightbox-content {
            max-width: 90%;
            max-height: 90%;
        }

        #lightbox-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 4px;
        }

        #lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }

        #lightbox-next,
        #lightbox-prev {
            position: absolute;
            color: white;
            font-size: 30px;
            cursor: pointer;
            top: 50%;
            transform: translateY(-50%);
        }

        #lightbox-next {
            right: 30px;
        }

        #lightbox-prev {
            left: 30px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="main-nav">
            <div class="logo">
                <svg width="50" height="50" viewBox="0 0 50 50" class="logo-svg">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="var(--primary-color)" stroke-width="2" />
                    <circle cx="25" cy="25" r="5" fill="var(--primary-color)" />
                    <path d="M25 10 L25 5" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M25 45 L25 40" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M10 25 L5 25" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M45 25 L40 25" stroke="var(--primary-color)" stroke-width="2" />
                </svg>
                <span>MOOK Robotics Hub</span>
            </div>
            <div class="nav-links">
                <a href="../index.html">Home</a>
                <a href="index.html" class="active">Encyclopedia</a>
                <a href="../news.html">News</a>
                <a href="../about.html">About</a>
                <a href="../admin/dashboard.html" class="admin-link"><i class="fas fa-cog"></i> Admin</a>
            </div>
            <div class="nav-auth">
                <button id="login-btn" class="btn btn-primary">Login</button>
                <button id="signup-btn" class="btn btn-outline">Sign Up</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="robot-breadcrumb">
            <div class="breadcrumb-container">
                <a href="../index.html">Home</a>
                <i class="fas fa-chevron-right"></i>
                <a href="index.html">Encyclopedia</a>
                <i class="fas fa-chevron-right"></i>
                <span id="robot-name-breadcrumb">Robot Details</span>
            </div>
        </div>

        <section class="robot-hero">
            <div class="robot-hero-container">
                <div class="robot-hero-image image-loading">
                    <img src="../images/robots/placeholder.jpg" alt="Robot" 
                         loading="eager"
                         onload="this.parentElement.classList.remove('image-loading')"
                         onerror="this.src='../images/robots/placeholder.jpg'; this.parentElement.classList.remove('image-loading')">
                </div>
                <div class="robot-hero-info">
                    <div class="robot-categories">
                        <span class="robot-category">Category</span>
                        <span class="robot-year">Year</span>
                    </div>
                    <h1>Robot Name</h1>
                    <p class="robot-manufacturer">Manufacturer</p>
                    <p class="robot-description">Loading description...</p>
                    <div class="robot-actions">
                        <a href="#specifications" class="btn btn-primary">Specifications</a>
                        <a href="#features" class="btn btn-outline">Features</a>
                    </div>
                </div>
            </div>
        </section>

        <div class="robot-content-container">
            <div class="robot-main-content">
                <section id="overview" class="robot-section">
                    <h2>Overview</h2>
                    <div class="robot-content">
                        <p>Loading content...</p>
                    </div>
                </section>

                <section id="features" class="robot-section">
                    <h2>Features</h2>
                    <ul class="features-list">
                        <li>Loading features...</li>
                    </ul>
                </section>

                <section id="specifications" class="robot-section">
                    <h2>Specifications</h2>
                    <div class="specs-container">
                        <div class="specs-column">
                            <div class="spec-group">
                                <h3>Technical Details</h3>
                                <p>Loading specifications...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="videos" class="robot-section" style="display: none;">
                    <h2>Videos</h2>
                    <div class="videos-container">
                        <p>Loading videos...</p>
                    </div>
                </section>

                <section id="gallery" class="robot-section">
                    <h2>Image Gallery</h2>
                    <div class="gallery-grid">
                        <p>Loading images...</p>
                    </div>
                </section>
            </div>

            <aside class="robot-sidebar">
                <div class="sidebar-section">
                    <h3>Quick Facts</h3>
                    <ul class="quick-facts">
                        <li>
                            <i class="fas fa-calendar-alt"></i>
                            <span class="fact-label">Year:</span>
                            <span class="fact-value">Loading...</span>
                        </li>
                        <li>
                            <i class="fas fa-building"></i>
                            <span class="fact-label">Manufacturer:</span>
                            <span class="fact-value">Loading...</span>
                        </li>
                        <li>
                            <i class="fas fa-tag"></i>
                            <span class="fact-label">Category:</span>
                            <span class="fact-value">Loading...</span>
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3>On This Page</h3>
                    <ul class="page-nav">
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#specifications">Specifications</a></li>
                        <li id="videos-nav" style="display: none;"><a href="#videos">Videos</a></li>
                        <li><a href="#gallery">Image Gallery</a></li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>Admin Actions</h3>
                    <ul class="page-nav">
                        <li><a href="../admin/dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                        <li><a href="../admin/add-robot.html"><i class="fas fa-plus-circle"></i> Add New Robot</a></li>
                        <li><a href="../admin/robots.html"><i class="fas fa-edit"></i> Edit Robots</a></li>
                    </ul>
                </div>
            </aside>
        </div>
    </main>

    <!-- Lightbox for gallery images -->
    <div id="lightbox">
        <div id="lightbox-close"><i class="fas fa-times"></i></div>
        <div id="lightbox-prev"><i class="fas fa-chevron-left"></i></div>
        <div id="lightbox-content"></div>
        <div id="lightbox-next"><i class="fas fa-chevron-right"></i></div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>MOOK Robotics Hub</h3>
                <p>Your interactive guide to the world of robotics</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="index.html">Encyclopedia</a></li>
                    <li><a href="../news.html">News</a></li>
                    <li><a href="../about.html">About</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                <ul>
                    <li><a href="mailto:info@mookrobotics.com">info@mookrobotics.com</a></li>
                    <li><a href="../contact.html">Contact Form</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Account</h3>
                <ul>
                    <li><a href="#login">Login</a></li>
                    <li><a href="#signup">Sign Up</a></li>
                    <li><a href="../my-account.html">My Account</a></li>
                    <li><a href="../admin/dashboard.html">Admin</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 MOOK Robotics Hub. All rights reserved.</p>
        </div>
    </footer>

    <!-- Floating Admin Button -->
    <a href="../admin/dashboard.html" class="admin-button" title="Go to Admin Dashboard">
        <i class="fas fa-cogs"></i>
    </a>

    <script src="../js/main.js"></script>
    <script src="../js/auth.js"></script>
    <script type="module">
        import { getRobotBySlug } from '../js/robot-service.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');
            const isPreview = urlParams.get('preview') === 'true';
            
            let robot;
            
            // Check if we're in preview mode
            if (isPreview && slug === 'preview') {
                // Get robot data from session storage
                const previewData = sessionStorage.getItem('robotPreview');
                if (previewData) {
                    robot = JSON.parse(previewData);
                    renderRobotDetails(robot);
                    
                    // Add a preview notice
                    const main = document.querySelector('main');
                    const previewNotice = document.createElement('div');
                    previewNotice.className = 'preview-notice';
                    previewNotice.innerHTML = '<i class="fas fa-eye"></i> This is a preview of the robot entry. Save the robot to make it appear in the encyclopedia.';
                    main.insertBefore(previewNotice, main.firstChild);
                } else {
                    showError('Preview data not found. Please go back to the Add Robot form and try again.');
                }
                return;
            }
            
            // Normal mode - get robot by slug from URL parameter
            if (!slug) {
                showError('Robot not specified. Please select a robot from the encyclopedia.');
                return;
            }
            
            // Get the robot data
            robot = getRobotBySlug(slug);
            
            if (!robot) {
                showError(`Robot "${slug}" not found.`);
                return;
            }
            
            // Populate the page with robot data
            renderRobotDetails(robot);
        });
        
        /**
         * Render robot details on the page
         * @param {Object} robot - Robot data object
         */
        function renderRobotDetails(robot) {
            // Update page title
            document.title = `${robot.name} - MOOK Robotics Hub`;
            
            // Update breadcrumb
            document.getElementById('robot-name-breadcrumb').textContent = robot.name;
            
            // Update main image
            const mainImage = document.querySelector('.robot-hero-image img');
            if (mainImage) {
                mainImage.src = `../${robot.mainImage || 'images/robots/placeholder.jpg'}`;
                mainImage.alt = robot.name;
                mainImage.onerror = function() {
                    this.src = '../images/robots/placeholder.jpg';
                    this.parentElement.classList.remove('image-loading');
                };
            }
            
            // Update hero section
            document.querySelector('.robot-hero-info h1').textContent = robot.name;
            document.querySelector('.robot-category').textContent = robot.category || 'Uncategorized';
            document.querySelector('.robot-year').textContent = robot.year || 'Unknown Year';
            document.querySelector('.robot-manufacturer').textContent = robot.manufacturer || 'Unknown Manufacturer';
            document.querySelector('.robot-description').textContent = robot.description || 'No description available.';
            
            // Update overview content
            const contentElement = document.querySelector('.robot-content');
            if (contentElement) {
                contentElement.innerHTML = robot.content || `<p>${robot.description || 'No detailed content available for this robot yet.'}</p>`;
                
                // Process video embeds if present in content
                processVideoEmbeds(contentElement);
            }
            
            // Update features list
            const featuresList = document.querySelector('.features-list');
            if (featuresList) {
                if (robot.features && robot.features.length > 0) {
                    featuresList.innerHTML = robot.features.map(feature => `<li>${feature}</li>`).join('');
                } else {
                    featuresList.innerHTML = '<li>No features listed.</li>';
                }
            }
            
            // Update specifications
            const specGroup = document.querySelector('.spec-group');
            if (specGroup && robot.specifications) {
                // Clear existing specs (keeping the h3 title)
                while (specGroup.children.length > 1) {
                    specGroup.removeChild(specGroup.lastChild);
                }
                
                // Add new specs
                if (Object.keys(robot.specifications).length > 0) {
                    Object.entries(robot.specifications).forEach(([key, value]) => {
                        const specItem = document.createElement('div');
                        specItem.className = 'spec-item';
                        
                        specItem.innerHTML = `
                            <span class="spec-label">${key.charAt(0).toUpperCase() + key.slice(1)}</span>
                            <span class="spec-value">${value}</span>
                        `;
                        
                        specGroup.appendChild(specItem);
                    });
                } else {
                    specGroup.innerHTML += '<p>No specifications available.</p>';
                }
            }
            
            // Update videos section
            const videosSection = document.getElementById('videos');
            const videosNav = document.getElementById('videos-nav');
            if (videosSection && robot.videos && robot.videos.length > 0) {
                const videosContainer = videosSection.querySelector('.videos-container');
                videosContainer.innerHTML = '';
                
                robot.videos.forEach(video => {
                    const videoItem = document.createElement('div');
                    videoItem.className = 'video-container';
                    
                    // Process different video types
                    if (video.type === 'youtube') {
                        videoItem.innerHTML = `
                            <iframe 
                                src="https://www.youtube-nocookie.com/embed/${video.id}" 
                                title="${video.title || robot.name}" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        `;
                    } else if (video.type === 'vimeo') {
                        videoItem.innerHTML = `
                            <iframe 
                                src="https://player.vimeo.com/video/${video.id}" 
                                title="${video.title || robot.name}" 
                                allow="autoplay; fullscreen; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        `;
                    } else if (video.type === 'file') {
                        videoItem.innerHTML = `
                            <video controls preload="metadata">
                                <source src="../${video.url}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        `;
                    }
                    
                    videosContainer.appendChild(videoItem);
                });
                
                // Show videos section and nav
                videosSection.style.display = 'block';
                videosNav.style.display = 'list-item';
            }
            
            // Update gallery
            const galleryGrid = document.querySelector('.gallery-grid');
            if (galleryGrid) {
                if (robot.gallery && robot.gallery.length > 0) {
                    galleryGrid.innerHTML = robot.gallery.map((image, index) => `
                        <div class="gallery-item image-loading">
                            <img 
                                src="../${image}" 
                                alt="${robot.name}" 
                                loading="lazy"
                                data-index="${index}"
                                onload="this.parentElement.classList.remove('image-loading')"
                                onerror="this.src='../images/robots/placeholder.jpg'; this.parentElement.classList.remove('image-loading')"
                                onclick="openLightbox(${index})">
                        </div>
                    `).join('');
                    
                    // Set up gallery lightbox functionality
                    setupGalleryLightbox(robot.gallery);
                } else {
                    galleryGrid.innerHTML = '<p>No additional images available.</p>';
                }
            }
            
            // Update quick facts sidebar
            const quickFacts = document.querySelector('.quick-facts');
            if (quickFacts) {
                const yearFact = quickFacts.querySelector('li:nth-child(1) .fact-value');
                const manufacturerFact = quickFacts.querySelector('li:nth-child(2) .fact-value');
                const categoryFact = quickFacts.querySelector('li:nth-child(3) .fact-value');
                
                if (yearFact) yearFact.textContent = robot.year || 'Unknown';
                if (manufacturerFact) manufacturerFact.textContent = robot.manufacturer || 'Unknown';
                if (categoryFact) categoryFact.textContent = robot.category || 'Unspecified';
            }
        }
        
        /**
         * Process video embeds in content
         * @param {HTMLElement} contentElement - The content element
         */
        function processVideoEmbeds(contentElement) {
            // Find all iframes in content
            const iframes = contentElement.querySelectorAll('iframe');
            
            iframes.forEach(iframe => {
                const parent = iframe.parentElement;
                // If the iframe is not already in a video container, wrap it
                if (!parent.classList.contains('video-container')) {
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-container';
                    parent.insertBefore(videoContainer, iframe);
                    videoContainer.appendChild(iframe);
                }
            });
        }
        
        /**
         * Set up lightbox functionality for gallery images
         * @param {Array} gallery - Gallery image URLs
         */
        function setupGalleryLightbox(gallery) {
            const lightbox = document.getElementById('lightbox');
            const lightboxContent = document.getElementById('lightbox-content');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxNext = document.getElementById('lightbox-next');
            const lightboxPrev = document.getElementById('lightbox-prev');
            
            let currentIndex = 0;
            const galleryUrls = gallery.map(img => `../${img}`);
            
            // Close lightbox function
            window.closeLightbox = function() {
                lightbox.style.display = 'none';
                document.body.style.overflow = 'auto';
            };
            
            // Open lightbox function
            window.openLightbox = function(index) {
                currentIndex = index;
                lightboxContent.innerHTML = `<img src="${galleryUrls[index]}" alt="Gallery image">`;
                lightbox.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // Show/hide navigation based on gallery length
                lightboxNext.style.display = galleryUrls.length > 1 ? 'block' : 'none';
                lightboxPrev.style.display = galleryUrls.length > 1 ? 'block' : 'none';
            };
            
            // Next image function
            lightboxNext.addEventListener('click', function() {
                currentIndex = (currentIndex + 1) % galleryUrls.length;
                lightboxContent.innerHTML = `<img src="${galleryUrls[currentIndex]}" alt="Gallery image">`;
            });
            
            // Previous image function
            lightboxPrev.addEventListener('click', function() {
                currentIndex = (currentIndex - 1 + galleryUrls.length) % galleryUrls.length;
                lightboxContent.innerHTML = `<img src="${galleryUrls[currentIndex]}" alt="Gallery image">`;
            });
            
            // Close on click of close button
            lightboxClose.addEventListener('click', closeLightbox);
            
            // Close on click outside the image
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });
            
            // Close on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && lightbox.style.display === 'flex') {
                    closeLightbox();
                }
                if (e.key === 'ArrowRight' && lightbox.style.display === 'flex' && galleryUrls.length > 1) {
                    currentIndex = (currentIndex + 1) % galleryUrls.length;
                    lightboxContent.innerHTML = `<img src="${galleryUrls[currentIndex]}" alt="Gallery image">`;
                }
                if (e.key === 'ArrowLeft' && lightbox.style.display === 'flex' && galleryUrls.length > 1) {
                    currentIndex = (currentIndex - 1 + galleryUrls.length) % galleryUrls.length;
                    lightboxContent.innerHTML = `<img src="${galleryUrls[currentIndex]}" alt="Gallery image">`;
                }
            });
        }
        
        /**
         * Show error message
         * @param {string} message - Error message
         */
        function showError(message) {
            const mainElement = document.querySelector('main');
            
            if (mainElement) {
                const errorElement = document.createElement('div');
                errorElement.className = 'error-container';
                
                errorElement.innerHTML = `
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2>Error</h2>
                    <p>${message}</p>
                    <a href="index.html" class="btn btn-primary">Return to Encyclopedia</a>
                `;
                
                mainElement.innerHTML = '';
                mainElement.appendChild(errorElement);
            } else {
                alert(`Error: ${message}`);
            }
        }
    </script>
</body>
</html>