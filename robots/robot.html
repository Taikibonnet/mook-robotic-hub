<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Details - MOOK Robotics Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="../css/encyclopedia.css">
    <link rel="stylesheet" href="../css/robot-detail.css">
    <link rel="stylesheet" href="../css/robot-detail-fix.css">
    <style>
        /* Additional inline styles for this page */
        .robot-hero-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .robot-hero-image {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            height: 400px; /* Fixed height for consistency */
            position: relative;
        }

        .robot-hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .robot-hero-info {
            flex: 2;
            min-width: 300px;
            padding: 1rem 0;
        }

        /* Media display improvements */
        .robot-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            margin: 1.5rem 0;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .video-container iframe,
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Gallery improvements */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .gallery-item {
            border-radius: 8px;
            overflow: hidden;
            height: 180px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            display: block;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        /* Improved lightbox */
        #lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #lightbox-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        #lightbox-content img {
            max-width: 100%;
            max-height: 90vh;
            display: block;
            margin: 0 auto;
        }
        
        #lightbox-close, #lightbox-prev, #lightbox-next {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        #lightbox-close:hover, #lightbox-prev:hover, #lightbox-next:hover {
            background-color: rgba(80, 80, 80, 0.9);
        }
        
        #lightbox-close {
            top: 20px;
            right: 20px;
        }
        
        #lightbox-prev {
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        #lightbox-next {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Preview notice styling */
        .preview-notice {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Error container */
        .error-container {
            max-width: 600px;
            margin: 4rem auto;
            text-align: center;
            padding: 2rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .error-icon {
            font-size: 48px;
            color: #dc3545;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <nav class="main-nav">
            <div class="logo">
                <svg width="50" height="50" viewBox="0 0 50 50" class="logo-svg">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="var(--primary-color)" stroke-width="2" />
                    <circle cx="25" cy="25" r="5" fill="var(--primary-color)" />
                    <path d="M25 10 L25 5" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M25 45 L25 40" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M10 25 L5 25" stroke="var(--primary-color)" stroke-width="2" />
                    <path d="M45 25 L40 25" stroke="var(--primary-color)" stroke-width="2" />
                </svg>
                <span>MOOK Robotics Hub</span>
            </div>
            <div class="nav-links">
                <a href="../index.html">Home</a>
                <i class="fas fa-chevron-right"></i>
                <a href="index.html">Encyclopedia</a>
                <i class="fas fa-chevron-right"></i>
                <span id="robot-name-breadcrumb">Robot Details</span>
            </div>
        </div>

        <section class="robot-hero">
            <div class="robot-hero-container">
                <div class="robot-hero-image">
                    <img id="robot-main-image" src="../images/robots/placeholder.jpg" alt="Robot" loading="eager">
                </div>
                <div class="robot-hero-info">
                    <div class="robot-categories">
                        <span id="robot-category" class="robot-category">Category</span>
                        <span id="robot-year" class="robot-year">Year</span>
                    </div>
                    <h1 id="robot-title">Robot Name</h1>
                    <p id="robot-manufacturer" class="robot-manufacturer">Manufacturer</p>
                    <p id="robot-description" class="robot-description">Loading description...</p>
                    <div class="robot-actions">
                        <a href="#specifications" class="btn btn-primary">Specifications</a>
                        <a href="#features" class="btn btn-outline">Features</a>
                    </div>
                </div>
            </div>
        </section>

        <div class="robot-content-container">
            <div class="robot-main-content">
                <section id="overview" class="robot-section">
                    <h2>Overview</h2>
                    <div id="robot-overview" class="robot-content">
                        <p>Loading content...</p>
                    </div>
                </section>

                <section id="features" class="robot-section">
                    <h2>Features</h2>
                    <ul id="robot-features" class="features-list">
                        <li>Loading features...</li>
                    </ul>
                </section>

                <section id="specifications" class="robot-section">
                    <h2>Specifications</h2>
                    <div class="specs-container">
                        <div id="robot-specs-container" class="spec-group">
                            <h3>Technical Details</h3>
                            <p>Loading specifications...</p>
                        </div>
                    </div>
                </section>

                <section id="videos" class="robot-section" style="display: none;">
                    <h2>Videos</h2>
                    <div id="videos-container" class="videos-container">
                        <p>Loading videos...</p>
                    </div>
                </section>

                <section id="gallery" class="robot-section">
                    <h2>Image Gallery</h2>
                    <div id="robot-gallery" class="gallery-grid">
                        <p>Loading images...</p>
                    </div>
                </section>
            </div>

            <aside class="robot-sidebar">
                <div class="sidebar-section">
                    <h3>Quick Facts</h3>
                    <ul class="quick-facts">
                        <li>
                            <i class="fas fa-calendar-alt"></i>
                            <span class="fact-label">Year:</span>
                            <span id="quick-year" class="fact-value">Loading...</span>
                        </li>
                        <li>
                            <i class="fas fa-building"></i>
                            <span class="fact-label">Manufacturer:</span>
                            <span id="quick-manufacturer" class="fact-value">Loading...</span>
                        </li>
                        <li>
                            <i class="fas fa-tag"></i>
                            <span class="fact-label">Category:</span>
                            <span id="quick-category" class="fact-value">Loading...</span>
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3>On This Page</h3>
                    <ul class="page-nav">
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#specifications">Specifications</a></li>
                        <li id="videos-nav" style="display: none;"><a href="#videos">Videos</a></li>
                        <li><a href="#gallery">Image Gallery</a></li>
                    </ul>
                </div>
                
                <div class="sidebar-section admin-only" style="display: none;">
                    <h3>Admin Actions</h3>
                    <ul class="page-nav">
                        <li><a href="../admin/dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                        <li><a href="../admin/add-robot.html"><i class="fas fa-plus-circle"></i> Add New Robot</a></li>
                        <li><a id="edit-this-robot" href="../admin/edit-robot.html"><i class="fas fa-edit"></i> Edit This Robot</a></li>
                    </ul>
                </div>
            </aside>
        </div>
    </main>

    <!-- Lightbox for gallery images -->
    <div id="lightbox" style="display: none;">
        <div id="lightbox-close"><i class="fas fa-times"></i></div>
        <div id="lightbox-prev"><i class="fas fa-chevron-left"></i></div>
        <div id="lightbox-content"></div>
        <div id="lightbox-next"><i class="fas fa-chevron-right"></i></div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>MOOK Robotics Hub</h3>
                <p>Your interactive guide to the world of robotics</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="index.html">Encyclopedia</a></li>
                    <li><a href="../news.html">News</a></li>
                    <li><a href="../index.html#about">About</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                <ul>
                    <li><a href="mailto:info@mookrobotics.com">info@mookrobotics.com</a></li>
                    <li><a href="../contact.html">Contact Form</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Account</h3>
                <ul>
                    <li><a href="#login" id="footer-login">Login</a></li>
                    <li><a href="#signup" id="footer-signup">Sign Up</a></li>
                    <li><a href="../my-account.html">My Account</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 MOOK Robotics Hub. All rights reserved.</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script src="../js/auth.js"></script>
    <script type="module">
        import { getRobotBySlug, getFileUrl } from '../js/robot-service.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');
            const isPreview = urlParams.get('preview') === 'true';
            const isAdmin = localStorage.getItem('isAdmin') === 'true' || urlParams.get('admin') === 'true';
            
            // Show admin elements if user is admin
            if (isAdmin) {
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelector('.admin-link').style.display = 'inline-block';
            }
            
            let robot;
            
            // Check if we're in preview mode
            if (isPreview && slug === 'preview') {
                // Get robot data from session storage
                const previewData = sessionStorage.getItem('robotPreview');
                if (previewData) {
                    robot = JSON.parse(previewData);
                    renderRobotDetails(robot);
                    
                    // Add a preview notice
                    const main = document.querySelector('main');
                    const previewNotice = document.createElement('div');
                    previewNotice.className = 'preview-notice';
                    previewNotice.innerHTML = '<i class="fas fa-eye"></i> This is a preview of the robot entry. Save the robot to make it appear in the encyclopedia.';
                    main.insertBefore(previewNotice, main.firstChild);
                } else {
                    showError('Preview data not found. Please go back to the Add Robot form and try again.');
                }
                return;
            }
            
            // Normal mode - get robot by slug from URL parameter
            if (!slug) {
                showError('Robot not specified. Please select a robot from the encyclopedia.');
                return;
            }
            
            // Get the robot data
            robot = getRobotBySlug(slug);
            
            if (!robot) {
                showError(`Robot "${slug}" not found.`);
                return;
            }
            
            // Populate the page with robot data
            renderRobotDetails(robot);
            
            // Set up edit link for this robot
            if (isAdmin) {
                const editLink = document.getElementById('edit-this-robot');
                if (editLink) {
                    editLink.href = `../admin/edit-robot.html?id=${robot.id}`;
                }
            }
        });
        
        /**
         * Render robot details on the page
         * @param {Object} robot - Robot data object
         */
        function renderRobotDetails(robot) {
            // Update page title
            document.title = `${robot.name} - MOOK Robotics Hub`;
            
            // Update breadcrumb
            document.getElementById('robot-name-breadcrumb').textContent = robot.name;
            
            // Update main image
            const mainImage = document.getElementById('robot-main-image');
            if (mainImage) {
                // If we have a mainImageUrl property (from enhanceRobotData), use that
                if (robot.mainImageUrl) {
                    mainImage.src = robot.mainImageUrl;
                } else if (robot.mainImage) {
                    // Otherwise use the path and let the browser resolve it
                    mainImage.src = robot.mainImage;
                } else {
                    mainImage.src = '../images/robots/placeholder.jpg';
                }
                
                mainImage.alt = robot.name;
                
                // Handle image loading errors
                mainImage.onerror = function() {
                    this.src = '../images/robots/placeholder.jpg';
                };
            }
            
            // Update hero section
            document.getElementById('robot-title').textContent = robot.name;
            document.getElementById('robot-category').textContent = robot.category || 'Uncategorized';
            document.getElementById('robot-year').textContent = robot.year || 'Unknown Year';
            document.getElementById('robot-manufacturer').textContent = robot.manufacturer || 'Unknown Manufacturer';
            document.getElementById('robot-description').textContent = robot.description || 'No description available.';
            
            // Update overview content
            const contentElement = document.getElementById('robot-overview');
            if (contentElement) {
                contentElement.innerHTML = robot.content || `<p>${robot.description || 'No detailed content available for this robot yet.'}</p>`;
                
                // Process images in content to ensure they load correctly
                const contentImages = contentElement.querySelectorAll('img');
                contentImages.forEach(img => {
                    // Add error handler
                    img.onerror = function() {
                        this.src = '../images/robots/placeholder.jpg';
                    };
                });
                
                // Process videos in content
                const iframes = contentElement.querySelectorAll('iframe');
                iframes.forEach(iframe => {
                    // Wrap iframes in video containers for responsive display
                    const parent = iframe.parentElement;
                    if (!parent.classList.contains('video-container')) {
                        const videoContainer = document.createElement('div');
                        videoContainer.className = 'video-container';
                        parent.insertBefore(videoContainer, iframe);
                        videoContainer.appendChild(iframe);
                    }
                });
            }
            
            // Update features list
            const featuresList = document.getElementById('robot-features');
            if (featuresList) {
                if (robot.features && robot.features.length > 0) {
                    featuresList.innerHTML = robot.features.map(feature => `<li>${feature}</li>`).join('');
                } else {
                    featuresList.innerHTML = '<li>No features listed.</li>';
                }
            }
            
            // Update specifications
            const specContainer = document.getElementById('robot-specs-container');
            if (specContainer && robot.specifications) {
                // Clear existing specs (keeping the h3 title)
                specContainer.innerHTML = '<h3>Technical Details</h3>';
                
                // Add new specs
                if (robot.specifications && Object.keys(robot.specifications).length > 0) {
                    Object.entries(robot.specifications).forEach(([key, value]) => {
                        const specItem = document.createElement('div');
                        specItem.className = 'spec-item';
                        
                        specItem.innerHTML = `
                            <span class="spec-label">${key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ')}</span>
                            <span class="spec-value">${value}</span>
                        `;
                        
                        specContainer.appendChild(specItem);
                    });
                } else {
                    specContainer.innerHTML += '<p>No specifications available.</p>';
                }
            }
            
            // Update videos section
            const videosSection = document.getElementById('videos');
            const videosNav = document.getElementById('videos-nav');
            const videosContainer = document.getElementById('videos-container');
            
            if (videosSection && videosContainer && robot.videos && robot.videos.length > 0) {
                videosContainer.innerHTML = '';
                
                robot.videos.forEach(video => {
                    const videoItem = document.createElement('div');
                    videoItem.className = 'video-container';
                    
                    // Process different video types
                    if (video.type === 'youtube') {
                        videoItem.innerHTML = `
                            <iframe 
                                src="https://www.youtube-nocookie.com/embed/${video.id}" 
                                title="${video.title || robot.name}" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        `;
                    } else if (video.type === 'vimeo') {
                        videoItem.innerHTML = `
                            <iframe 
                                src="https://player.vimeo.com/video/${video.id}" 
                                title="${video.title || robot.name}" 
                                allow="autoplay; fullscreen; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        `;
                    } else if (video.type === 'file') {
                        videoItem.innerHTML = `
                            <video controls preload="metadata">
                                <source src="${video.url}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        `;
                    }
                    
                    videosContainer.appendChild(videoItem);
                });
                
                // Show videos section and nav
                videosSection.style.display = 'block';
                videosNav.style.display = 'list-item';
            }
            
            // Update gallery
            const galleryGrid = document.getElementById('robot-gallery');
            if (galleryGrid) {
                if (robot.gallery && robot.gallery.length > 0) {
                    galleryGrid.innerHTML = '';
                    
                    // Use galleryUrls if available (from enhanceRobotData)
                    const galleryImages = robot.galleryUrls || robot.gallery;
                    
                    // Create gallery items
                    galleryImages.forEach((imagePath, index) => {
                        const galleryItem = document.createElement('div');
                        galleryItem.className = 'gallery-item';
                        
                        const img = document.createElement('img');
                        img.src = imagePath;
                        img.alt = `${robot.name} - Image ${index + 1}`;
                        img.dataset.index = index;
                        img.loading = 'lazy';
                        
                        // Handle image errors
                        img.onerror = function() {
                            this.src = '../images/robots/placeholder.jpg';
                        };
                        
                        // Open lightbox on click
                        img.onclick = function() {
                            openLightbox(index);
                        };
                        
                        galleryItem.appendChild(img);
                        galleryGrid.appendChild(galleryItem);
                    });
                    
                    // Set up gallery lightbox functionality
                    setupGalleryLightbox(galleryImages);
                } else {
                    galleryGrid.innerHTML = '<p>No additional images available.</p>';
                }
            }
            
            // Update quick facts sidebar
            document.getElementById('quick-year').textContent = robot.year || 'Unknown';
            document.getElementById('quick-manufacturer').textContent = robot.manufacturer || 'Unknown';
            document.getElementById('quick-category').textContent = robot.category || 'Unspecified';
        }
        
        /**
         * Set up lightbox functionality for gallery images
         * @param {Array} gallery - Gallery image URLs
         */
        function setupGalleryLightbox(gallery) {
            const lightbox = document.getElementById('lightbox');
            const lightboxContent = document.getElementById('lightbox-content');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxNext = document.getElementById('lightbox-next');
            const lightboxPrev = document.getElementById('lightbox-prev');
            
            let currentIndex = 0;
            
            // Close lightbox function
            window.closeLightbox = function() {
                lightbox.style.display = 'none';
                document.body.style.overflow = 'auto';
            };
            
            // Open lightbox function
            window.openLightbox = function(index) {
                currentIndex = index;
                lightboxContent.innerHTML = `<img src="${gallery[index]}" alt="Gallery image">`;
                lightbox.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // Show/hide navigation based on gallery length
                lightboxNext.style.display = gallery.length > 1 ? 'block' : 'none';
                lightboxPrev.style.display = gallery.length > 1 ? 'block' : 'none';
            };
            
            // Next image function
            lightboxNext.addEventListener('click', function() {
                currentIndex = (currentIndex + 1) % gallery.length;
                lightboxContent.innerHTML = `<img src="${gallery[currentIndex]}" alt="Gallery image">`;
            });
            
            // Previous image function
            lightboxPrev.addEventListener('click', function() {
                currentIndex = (currentIndex - 1 + gallery.length) % gallery.length;
                lightboxContent.innerHTML = `<img src="${gallery[currentIndex]}" alt="Gallery image">`;
            });
            
            // Close on click of close button
            lightboxClose.addEventListener('click', closeLightbox);
            
            // Close on click outside the image
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });
            
            // Handle keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (lightbox.style.display !== 'flex') return;
                
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowRight' && gallery.length > 1) {
                    currentIndex = (currentIndex + 1) % gallery.length;
                    lightboxContent.innerHTML = `<img src="${gallery[currentIndex]}" alt="Gallery image">`;
                } else if (e.key === 'ArrowLeft' && gallery.length > 1) {
                    currentIndex = (currentIndex - 1 + gallery.length) % gallery.length;
                    lightboxContent.innerHTML = `<img src="${gallery[currentIndex]}" alt="Gallery image">`;
                }
            });
        }
        
        /**
         * Show error message
         * @param {string} message - Error message
         */
        function showError(message) {
            const mainElement = document.querySelector('main');
            
            if (mainElement) {
                const errorElement = document.createElement('div');
                errorElement.className = 'error-container';
                
                errorElement.innerHTML = `
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2>Error</h2>
                    <p>${message}</p>
                    <a href="index.html" class="btn btn-primary">Return to Encyclopedia</a>
                `;
                
                mainElement.innerHTML = '';
                mainElement.appendChild(errorElement);
            } else {
                alert(`Error: ${message}`);
            }
        }
    </script>
</body>
</html><a href="index.html" class="active">Encyclopedia</a>
                <a href="../news.html">News</a>
                <a href="../index.html#about">About</a>
                <a href="../admin/dashboard.html" class="admin-link" style="display: none;"><i class="fas fa-cog"></i> Admin</a>
            </div>
            <div class="nav-auth">
                <button id="login-btn" class="btn btn-primary">Login</button>
                <button id="signup-btn" class="btn btn-outline">Sign Up</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="robot-breadcrumb">
            <div class="breadcrumb-container">
                <a href="../index.html">Home</a>
